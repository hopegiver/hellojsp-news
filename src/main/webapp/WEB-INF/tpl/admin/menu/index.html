<div class="page-content container" style="margin-left: 0">
    <div class="page-header">
        <h1 class="page-title text-primary-d2">
            Menu
            <small class="page-info text-secondary-d2">
                <i class="fa fa-angle-double-right text-80"></i>
                Admin editable menu list
            </small>
        </h1>
    </div>
    <div class="row" style="padding-bottom: 50px">
        <div class="col-12 col-md-6 mt-3 mt-md-0">
            <div class="card border-0">
                <div class="card-header bgc-default-d2">
                    <h3 class="card-title text-130 text-white">
                        Menu tree view
                    </h3>
                </div>
                <div class="card-body bgc-white border-1 border-t-0 brc-default-m2">
                    <div class="jqtree" id="id-jqtree-categories"></div>
                </div>
            </div>
        </div>
    <div class="col-6">
        <form name="form1" method="post" class="form-horizontal" enctype="multipart/form-data">
            <div class="form-group">
                <label class="control-label col-sm-6">Module</label>
                <div class="col-sm-12"><input type="text" name="module" class="form-control"></div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-6">Menu Name</label>
                <div class="col-sm-12"><input type="text" name="menu_name"  class="form-control"></div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-6">Module Id</label>
                <div class="col-sm-5">
                    <select class="form-control ace-select text-dark-m1 bgc-default-l5 bgc-h-warning-l3  brc-default-m3 brc-h-warning-m1" name="module_id">
                        <option value="">Select</option>
                        <option value="1">Home</option>
                        <option value="2">News</option>
                        <option value="3">Media news</option>
                        <option value="4">Gallery</option>
                        <option value="5">Blog news</option>
                        <option value="6">Comment</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-6">Parent Id</label>
                <div class="col-sm-6">
                    <select class="form-control ace-select text-dark-m1 bgc-default-l5 bgc-h-warning-l3  brc-default-m3 brc-h-warning-m1" name="parent_id" id="select">
                        <option value="0">Select</option>
                        #foreach($parent in $parent)
                        <option value="${parent.id}">${parent.menu_name}</option>
                        #end
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2">Sort</label>
                <div class="col-sm-3"><input type="text" name="sort"  class="form-control"></div>
            </div>

            <div class="form-group">
                <div class="row">
                <div class="col-sm-offset-2 col-sm-9">
                    <a href="index.jsp" class="btn btn-info">New</a>
                    <input type="submit" value="Save" class="btn btn-success">
                    <input type="button" value="Cancel" class="btn btn-default" onclick="history.go(-1)">
                </div>
                <div class="col-sm-offset-2 col-sm-2">
                    <button id="delete" class="btn btn-danger">Delete</button>
                </div>
                </div>
            </div>
        </form>
        ${form_script}
    </div>
    </div>
    <hr class="border-double my-4 brc-secondary-l2" />
    <script>
        id = ${id};
        var categoryData = [
    #foreach($item in $menuInfo)
        #if(${item.parent_id} == 0)
            {
        id: ${item.id},
        name: "${item.menu_name}",
        children: [
            #foreach($subItem in $subMenu)
            #if(${item.id} == ${subItem.parent_id} && ${subItem.parent_id} > 0)
            {
                id: ${subItem.id},
                name: "${subItem.menu_name}"
            },
        #end
        #end
        ]
            },
        #end
    #end
    ];

    $('#delete').click(function(){
        var checkstr =  confirm('Are you sure you want to delete this menu?');
        if(checkstr == true){
            var url = window.location.pathname;
            location.replace(url + "?id=" + id + "&del=1");
        }else{
            return false;
        }
    });

        var selectedIcon =
            '<span class="selected-icon d-inline-block text-center border-1 bgc-warning px-1px mx-1 text-70 pb-1px radius-2px">\
                <i class="w-2 fa fa-check text-white"></i>\
            </span>';

        var deselectedIcon =
            '<span class="deselected-icon d-inline-block text-center border-1 bgc-white brc-secondary-m3 px-1px mx-1 text-70 pb-1px radius-2px">\
                <i class="w-2 fa fa-times text-orange-l4"></i>\
            </span>';


        var categoryTree = $('#id-jqtree-categories');
        categoryTree.tree({
            data: categoryData,
            autoOpen: true,
            useContextMenu: false,

            closedIcon : $('<i class="bgc-white w-2 far fa-plus-square text-grey-l1 text-110"></i>'),
            openedIcon : $('<i class="bgc-white w-2 far fa-minus-square text-default-d2 text-110"></i>'),

            onCreateLi: function(node, $li, is_selected) {
                // insert the icon
                var title = $li.find('.jqtree-title');
                if(node.children.length == 0) {
                    title.addClass('text-grey-d2 text-95');
                    if( is_selected ) {
                        $(selectedIcon).insertBefore(title);
                    }
                    else {
                        $(deselectedIcon).insertBefore(title);
                    }
                }
                else {
                    title.addClass('text-secondary-d3 font-italic');
                }
                $li.find('.jqtree-element').addClass('bgc-h-warning-l3 radius-1');
            }
        });

        categoryTree.on( 'tree.click', function(e) {
            // Disable single selection
            //e.preventDefault();

            var selectedNode = e.node;
            if (selectedNode.id === undefined || selectedNode.children.length > 0) {
                return;
            }

            if( id == selectedNode.id ) {
                //if already selected, deselect it
                categoryTree.tree('removeFromSelection', selectedNode);

                //insert deselectedIcon and remove .selected-icon
                var icon = $(selectedNode.element).find('.selected-icon');
                $(deselectedIcon).insertAfter(icon);
                icon.remove();
            }
            else {
                categoryTree.tree('addToSelection', selectedNode);

                //insert selectedIcon and remove .deselected-icon
                var icon = $(selectedNode.element).find('.deselected-icon');
                $(selectedIcon).insertAfter(icon);
                icon.remove();
            }
        });

        categoryTree.on( 'tree.click', function(e) {
            var selectedNode = e.node;
            if (selectedNode.id != 0) {
                var url = window.location.pathname;

                location.replace(url + "?id=" + selectedNode.id);
            }
        });

    </script>
</div>